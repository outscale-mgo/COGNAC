#!/bin/sh

# go https://github.com/niess/python-appimage/releases for the list

JSON_SEARCH=json-search
YQ_ARG=''
CURL_LD='-lcurl'
CURL_CFLAGS=''

for arg in $@; do
    if [ "--help" = $arg ]; then
	cat <<EOF
./configure:
   --help				like seriously ?
   --wget-json-search			wget json-search.Appimage
   --yq-go                              use go version of yq, that use diferents arguments
   --curl-path=PATH			path to curl source root
EOF
	exit 0
    fi
    if [ "--wget-json-search" = $( echo "$arg" | cut -d '=' -f 1) ]; then
	wget https://github.com/cosmo-ray/json-search/releases/download/0.2/json-search-x86_64.AppImage
	chmod +x json-search-x86_64.AppImage
	JSON_SEARCH="./json-search-x86_64.AppImage"
    elif [ "--yq-go" = $arg ]; then
	YQ_ARG="-o json"
    elif [ "--curl-path" = $( echo "$arg" | cut -d '=' -f 1) ]; then
	CURL_PATH=$( echo $arg | cut -f 2 -d '=' )
	CURL_LD="-lcurl -L$CURL_PATH/lib/.libs/"
	CURL_CFLAGS="-I$CURL_PATH/include/"
    fi
done

echo JSON_SEARCH=$JSON_SEARCH > config.mk
echo YQ_ARG=$YQ_ARG >> config.mk
echo CURL_LD=$CURL_LD >> config.mk
echo CURL_CFLAGS=$CURL_CFLAGS >> config.mk
echo "config done:"
cat config.mk
